<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_Security
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

$numColumns = count($block->getColumns());
?>
<?php if ($block->getCollection()) : ?>
    <?php if ($block->isReports()) : ?>
        <style>
            #container > #mp-login-log {
                display: none;
            }

            #mp-login-log > .dashboard-item-title {
                display: none;
            }
        </style>
    <?php endif; ?>
    <div class="dashboard-item" id="mp-login-log">
        <div class="dashboard-item-title"><?= __('Login Log') ?></div>
        <div class="dashboard-item-content">
            <?php if ($block->getCollection()->getSize() > 0) : ?>
                <table class="admin__table-primary dashboard-data" id="<?= $block->getId() ?>_table">
                    <?php
                    /* This part is commented to remove all <col> tags from the code. */
                    /* foreach ($block->getColumns() as $_column): ?>
                    <col <?= $_column->getHtmlProperty() ?> />
                    <?php endforeach; */ ?>
                    <?php if ($block->getHeadersVisibility() || $block->getFilterVisibility()) : ?>
                        <thead>
                        <?php if ($block->getHeadersVisibility()) : ?>
                            <tr>
                                <?php foreach ($block->getColumns() as $_column) : ?>
                                    <?= $_column->getHeaderHtml() ?>
                                <?php endforeach; ?>
                            </tr>
                        <?php endif; ?>
                        </thead>
                    <?php endif; ?>
                    <?php if (!$block->getIsCollapsed()) : ?>
                        <tbody>
                        <?php foreach ($block->getCollection() as $_index => $_item) : ?>
                            <tr title="<?= $block->getRowUrl($_item) ?>">
                                <?php $i = 0;
                                foreach ($block->getColumns() as $_column) : ?>
                                    <td class="<?= $_column->getCssProperty() ?> <?= ++$i === $numColumns ? 'last' : '' ?>">
                                        <?= ($_column->getRowField($_item) != '') ? $_column->getRowField($_item) : '&nbsp;' ?>
                                    </td>
                                <?php endforeach; ?>
                            </tr>
                        <?php endforeach; ?>
                        </tbody>
                    <?php endif; ?>
                </table>
            <?php else : ?>
                <div class="<?= $block->getEmptyTextClass() ?>"><?= $block->getEmptyText() ?></div>
            <?php endif; ?>
        </div>
    </div>
    <script>
        require([
            'jquery'
        ], function ($) {
            $(document).ready(function () {
                $('.dashboard-secondary').append($('#mp-login-log'));
            })
        });
    </script>
    <?php if ($block->canDisplayContainer()) : ?>
        <script>
            var deps = [];

            <?php if ($block->getDependencyJsObject()) : ?>
            deps.push('uiRegistry');
            <?php endif; ?>

            <?php if (strpos($block->getRowClickCallback(), 'order.') !== false) : ?>
            deps.push('Magento_Sales/order/create/form');
            <?php endif; ?>

            deps.push('mage/adminhtml/grid');

            require(deps, function (<?=($block->getDependencyJsObject() ? 'registry' : '') ?>) {
                <?php //TODO: getJsObjectName and getRowClickCallback has unexpected behavior. Should be removed ?>

                <?php if ($block->getDependencyJsObject()) : ?>
                registry.get('<?= $block->getDependencyJsObject() ?>', function (<?= $block->getDependencyJsObject() ?>) {
                <?php endif; ?>

                    <?= $block->getJsObjectName() ?> = new varienGrid('<?= $block->getId() ?>', '<?= $block->getGridUrl() ?>', '<?= $block->getVarNamePage() ?>', '<?= $block->getVarNameSort() ?>', '<?= $block->getVarNameDir() ?>', '<?= $block->getVarNameFilter() ?>');
                    <?= $block->getJsObjectName() ?>.
                    useAjax = '<?= $block->getUseAjax() ?>';
                    <?php if ($block->getRowClickCallback()) : ?>
                        <?= $block->getJsObjectName() ?>.
                    rowClickCallback = <?= $block->getRowClickCallback() ?>;
                    <?php endif; ?>
                    <?php if ($block->getCheckboxCheckCallback()) : ?>
                        <?= $block->getJsObjectName() ?>.
                    checkboxCheckCallback = <?= $block->getCheckboxCheckCallback() ?>;
                    <?php endif; ?>
                    <?php if ($block->getRowInitCallback()) : ?>
                        <?= $block->getJsObjectName() ?>.
                    initRowCallback = <?= $block->getRowInitCallback() ?>;
                        <?= $block->getJsObjectName() ?>.
                    rows.each(function (row) {
                        <?= $block->getRowInitCallback() ?>(<?= $block->getJsObjectName() ?>, row
                    )
                    });
                    <?php endif; ?>
                    <?php if ($block->getMassactionBlock()->isAvailable()) : ?>
                        <?= $block->getMassactionBlock()->getJavaScript() ?>
                    <?php endif ?>

                    <?php if ($block->getDependencyJsObject()) : ?>
                });
                    <?php endif; ?>
            });
        </script>
    <?php endif; ?>
<?php endif ?>


